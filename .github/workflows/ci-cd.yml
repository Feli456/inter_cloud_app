# .github/workflows/cics.yaml
name: CI/CD Laborator

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  simulate-ci-cd:
    name: Rulează linters și simulare deploy
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Install yamllint
      run: |
        sudo apt-get update -y
        sudo apt-get install -y yamllint

    - name: Validare fișiere YAML
      run: |
        yamllint k8s/

    - name: Verificare sintaxă PHP
      if: ${{ hashFiles('php/**/*.php') != '' }}
      run: |
        find php -type f -name '*.php' -print0 | xargs -0 -I{} php -l {}

    - name: Build imagine Docker "inter_cloud-web"
      if: ${{ hashFiles('**/Dockerfile') != '' }}
      run: |
        docker build -t inter_cloud-web .

    - name: Simulare deploy Kubernetes
      run: |
        echo "kubectl apply -f k8s/mysql-initdb-config.yaml"
        echo "kubectl apply -f k8s/mysql-deployment.yaml"
        echo "kubectl apply -f k8s/mysql-service.yaml"
        echo "kubectl apply -f k8s/web-deployment.yaml"
        echo "kubectl apply -f k8s/web-service.yaml"
